/* ============================================================
   ANIMATIONS CSS - RISC-V Simulator
============================================================ */

/* Cable inactivo */
.wire {
    stroke: #334155;
    stroke-width: 2px;
    fill: none;
    transition: stroke 0.3s ease, filter 0.3s ease;
}

/* Cable activo  */
.wire.active {
    stroke: #4ade80; 
    filter: drop-shadow(0 0 4px rgba(74, 222, 128, 0.6));
    animation: flow 1s linear infinite;
}

/* Componente activo */
.component.active {
    stroke: #fbbf24; 
    stroke-width: 2px;
    filter: drop-shadow(0 0 6px rgba(251, 191, 36, 0.4));
}

/* Animación de flujo de datos */
@keyframes flow {
    to {
        stroke-dashoffset: -20;
    }
}

/* Animación de pulso brillante para las pills activas */
@keyframes pulse-glow {
    0%, 100% {
        box-shadow: 
            0 0 20px rgba(34, 197, 94, 0.6),
            0 0 40px rgba(34, 197, 94, 0.4),
            0 4px 8px rgba(0, 0, 0, 0.3);
    }
    50% {
        box-shadow: 
            0 0 30px rgba(34, 197, 94, 0.8),
            0 0 60px rgba(34, 197, 94, 0.6),
            0 4px 12px rgba(0, 0, 0, 0.4);
    }
}

/* ============================================================
   FIELD ANIMATIONS
============================================================ */
.format-table td.active {
    animation: fieldPulse 0.4s ease;
}

@keyframes fieldPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* ============================================================
   IMMEDIATE FIELD ANIMATIONS
============================================================ */
.format-table td.imm-field {
    animation: immFieldAppear 0.3s ease;
}

@keyframes immFieldAppear {
    0% { 
        border-color: transparent;
    }
    100% { 
        border-color: var(--field-imm, #06b6d4);
    }
}

/* Efecto de onda para campos de inmediato */
.format-table td.imm-highlight {
    animation: immWave 0.5s ease forwards;
}

@keyframes immWave {
    0% { 
        transform: scale(1);
        background: rgba(6, 182, 212, 0.1);
    }
    30% { 
        transform: scale(1.08);
        background: rgba(6, 182, 212, 0.4);
    }
    60% {
        transform: scale(1.02);
        background: rgba(6, 182, 212, 0.3);
    }
    100% { 
        transform: scale(1.02);
        background: rgba(6, 182, 212, 0.25);
    }
}

/* ============================================================
   TOAST STYLES ADICIONALES
============================================================ */
.toast {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.toast svg {
    flex-shrink: 0;
}

/* ============================================================
   BUTTON ANIMATIONS
============================================================ */
.btn:hover svg {
    animation: buttonIconBounce 0.3s ease;
}

@keyframes buttonIconBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-2px); }
}

/* ============================================================
   STAGE PILL ANIMATIONS
============================================================ */
.stage-pill.active {
    animation: stageActive 0.5s ease;
}

@keyframes stageActive {
    0% { transform: scale(0.9); opacity: 0.5; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
}

/* ============================================================
   REGISTER ROW HIGHLIGHT
============================================================ */
.registers-table tbody tr.highlight td {
    position: relative;
}

.registers-table tbody tr.highlight td::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.2), transparent);
    animation: registerHighlight 0.5s ease;
    pointer-events: none;
}

@keyframes registerHighlight {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* ============================================================
   SIDEBAR TRANSITION
============================================================ */
.controls-section {
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.3s ease;
}

.btn-collapse svg {
    transition: transform 0.3s ease;
}

/* ============================================================
   PANEL HOVER EFFECTS
============================================================ */
.panel {
    transition: transform 0.2s ease,
                border-color 0.2s ease,
                box-shadow 0.2s ease;
}

.panel:hover {
    transform: translateY(-1px);
}

/* ============================================================
   INPUT FOCUS ANIMATIONS
============================================================ */
.input-group textarea {
    transition: border-color 0.2s ease,
                box-shadow 0.2s ease,
                background-color 0.2s ease;
}

/* ============================================================
   LOADING STATE
============================================================ */
.loading {
    position: relative;
    pointer-events: none;
}

.loading::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    border-radius: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ============================================================
   SKELETON LOADING
============================================================ */
.skeleton {
    background: linear-gradient(
        90deg,
        var(--bg-elevated) 25%,
        var(--bg-card) 50%,
        var(--bg-elevated) 75%
    );
    background-size: 200% 100%;
    animation: skeleton 1.5s ease infinite;
}

@keyframes skeleton {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* ============================================================
   DATAPATH (SVG) — NEON/TECH (sutil-profesional)
   Nota: no mueve geometría; solo estilos/animaciones.
============================================================ */

#datapath-container svg {
    /* Afinar render de strokes */
    shape-rendering: geometricPrecision;
}

/* Buses/cables */
#datapath-container svg path.dp-wire {
    transition: stroke 180ms ease, filter 180ms ease, opacity 180ms ease;
}

/* Hover: iluminar cualquier cable aunque no esté 'active' */
#datapath-container svg path.dp-wire.dp-wire-hover {
    stroke-opacity: 1 !important;
    stroke-width: 3.4 !important;
    stroke-linecap: round !important;
    stroke-linejoin: round !important;
    filter:
        drop-shadow(0 0 8px rgba(255, 255, 255, 0.18))
        drop-shadow(0 0 16px var(--accent-glow))
        !important;
}

#datapath-container svg path.dp-wire.active {
    /* Mantener el color base del SVG, pero mejorar el “neón” */
    stroke-linecap: round !important;
    stroke-linejoin: round !important;
    stroke-dasharray: 10 7 !important;
    animation: dp-dash-flow 1.35s ease-in-out infinite !important;
    filter:
        drop-shadow(0 0 6px var(--accent-glow))
        drop-shadow(0 0 14px rgba(59, 130, 246, 0.18))
        !important;
}

/* Etiqueta de valor (decimal) viajando sobre el cable */
#datapath-container svg .dp-value-tag {
    filter: drop-shadow(0 0 10px var(--accent-glow));
}

#datapath-container svg .dp-value-tag .dp-value-bg {
    fill: var(--bg-panel);
    fill-opacity: 0.92;
    stroke: var(--accent-primary);
    stroke-opacity: 0.55;
    stroke-width: 1;
}

#datapath-container svg .dp-value-tag .dp-value-text {
    fill: var(--text-primary);
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 700;
    paint-order: stroke;
    stroke: var(--bg-dark);
    stroke-opacity: 0.55;
    stroke-width: 2px;
}

/* Módulos (hover 3D) */
#datapath-container svg .dp-module {
    transform-box: fill-box;
    transform-origin: center;
    transition: transform 160ms ease, filter 160ms ease, opacity 160ms ease;
    will-change: transform, filter;
}

#datapath-container svg .dp-module.dp-hovered {
    opacity: 0.98;
    filter:
        drop-shadow(0 10px 22px rgba(0, 0, 0, 0.45))
        drop-shadow(0 0 16px var(--accent-glow));
    transform:
        perspective(900px)
        rotateX(var(--dp-tilt-x, 0deg))
        rotateY(var(--dp-tilt-y, 0deg))
        scale(1.045);
}


@keyframes dp-dash-flow {
    0% { stroke-dashoffset: 0; opacity: 0.92; }
    50% { stroke-dashoffset: 16; opacity: 1; }
    100% { stroke-dashoffset: 32; opacity: 0.92; }
}

/* Paquetes (punto viajando) */
#datapath-container svg .dp-packet {
    fill: var(--accent-primary);
    opacity: 0.9;
    filter:
        drop-shadow(0 0 4px var(--accent-glow))
        drop-shadow(0 0 10px rgba(59, 130, 246, 0.22));
}

#datapath-container svg .dp-packet.dp-packet-soft {
    opacity: 0.65;
}

/* Componentes (módulos) */
#datapath-container svg .dp-module.active {
    animation: dp-module-breath 1.4s ease-in-out infinite !important;
    filter:
        drop-shadow(0 0 10px rgba(59, 130, 246, 0.18))
        drop-shadow(0 0 20px rgba(59, 130, 246, 0.10))
        !important;
}

@keyframes dp-module-breath {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.92; }
}

/* “Ping” corto para eventos (write-back, mem write, etc.) */
#datapath-container svg .dp-ping {
    animation: dp-ping 320ms ease-out 1;
}

@keyframes dp-ping {
    0% { filter: drop-shadow(0 0 0 rgba(59, 130, 246, 0)); }
    40% { filter: drop-shadow(0 0 14px rgba(59, 130, 246, 0.35)); }
    100% { filter: drop-shadow(0 0 0 rgba(59, 130, 246, 0)); }
}
